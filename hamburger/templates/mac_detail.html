{% extends 'base.html' %}
{% load static %}

{% block title %}商品一覧｜Shop Menu{% endblock %}

{% block extrahead %}
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" />
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
<!-- MDB -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.1/mdb.min.css" rel="stylesheet" />
{% endblock %}
{% block contents %}

<section>
  <div class="container px-5">
      <div class="row gx-5 align-items-center">
          <div class="col-lg-6">
              <div class="p-5"><img class="img-fluid" src="{{ object.photo.url }}" alt="..." /></div>
          </div>
          <div class="col-lg-6">
              <div class="p-5">
                  <h3 class="display-4">{{ object.name }}</h3>
                  <br>
                  <h4 class="display-5">{{ object.price }}円</h4>
              </div>
          </div>
            <h2 class="border-bottom border-4 border-dark">詳細</h2>
            <h3>{{ object.ditail }}</h3>

          
      </div>
      {% if user.is_authenticated %}
            <a class="btn btn-success mt-5 mb-3" href="{% url 'hamburger:Mac_update' object.pk %}">編集</a>
            <a class="btn btn-danger mt-5 ml-2 mb-3" href="{% url 'hamburger:Mac_delete' object.pk %}">削除</a>
            <div class="card-header">
                {% if is_user_liked_for_post %}
                <button type="button" id="ajax-like-for-post" style="border:none;background:none">
                  <!-- すでにイイねしている時はfasクラス -->
                  <i class="fas fa-heart text-danger" id="like-for-post-icon"></i>
                </button>
                {% else %}
                <button type="button" id="ajax-like-for-post" style="border:none;background:none">
                  <!-- イイねしていないときはfarクラス -->
                  <i class="far fa-heart text-danger" id="like-for-post-icon"></i>
                </button>
                {% endif %}
                <!-- イイねの数 -->
                <span id="like-for-post-count">{{ like_for_post_count }}</span>
                <span>件のイイね</span>
              </div>
      {% endif %}
  </div>
</section>

{% endblock %}

{% block extrajs %}
<script type="text/javascript">
  /* ポストに対するイイね */
  document.getElementById('ajax-like-for-post').addEventListener('click', e => {
    e.preventDefault();
    const url = '{% url "hamburger:mac_for_post" %}';
    fetch(url, {
      method: 'POST',
      body: `post_pk={{post.pk}}`,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',
        'X-CSRFToken': '{{ csrf_token }}',
      },
    }).then(response => {
      return response.json();
    }).then(response => {
       // イイね数を書き換える
      const counter = document.getElementById('like-for-post-count')
      counter.textContent = response.like_for_post_count
      const icon = document.getElementById('like-for-post-icon')
      // 作成した場合はハートを塗る
      if (response.method == 'create') {
        icon.classList.remove('far')
        icon.classList.add('fas')
        icon.id = 'like-for-post-icon'
      } else {
        icon.classList.remove('fas')
        icon.classList.add('far')
        icon.id = 'like-for-post-icon'
      }
    }).catch(error => {
      console.log(error);
    });
  });
</script>


{% endblock %}
